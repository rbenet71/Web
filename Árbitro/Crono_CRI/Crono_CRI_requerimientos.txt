Crono CRI

#### Traspasar a otras app - cerrar bloques, botones en grid

Quiero crear una app para ayudar a las salidas de las contra relojes de ciclismo.

Partiendo de la app cuenta atrás, la diferencia es que se importará un Excel con todos los datos de la cri, por tanto se ha de mantener diseño y estructura igual y solo añadir la parte de entrada de datos de corredores y tiempos de salida. Además en la pantalla de cuenta atrás se mostrarán los datos del corredor.

iconos: Crono_CRI_192x192.png Crono_CRI_512x512.png

Vamos a detallar.

Sustituiremos el apartado de salida por tramos por el nombre de Orden de Salida.
Ese orden se podrá introducir manualmente o a través de importar un excel.

El fichero será un xlsx con las siguientes columnas
Número de orden
Dorsal
Tiempo de salida ( respecto al tiempo del crono) 
Hora de salida ( según hora del día)
Nombre
Apellido

Habrá un campo para fijar a que hora se empieza la cuenta atras y es a esa hora que el programa automaticamente arrancará la pantalla de cuenta atras.

El crono hará las cuentas atrás en función de este Excel y del campo tiempo de salida.

Se ha de poder introducir manualmente el orden de salida, siendo únicamente obligatorio el dorsal y tiempo de salida, al crear nuevo registro ha de calcular el nuevo tiempo de salida en función de cuánto fue la última vez la diferencia entre el corredor anterior y al previo a ese.

El usuario ha de poder modificar los datos del orden de salida, borrar la importación realizada.

Que haya la opción de crear el Excel vacío para que el usuario lo rellene

En la pantalla de cuenta atrás se mostrará en la parte superior lo mismo, pero en la parte inferior de la pantalla : número de dorsal, apellido,”,”, nombre, hora de salida y tiempo de salida del próximo corredor. 
Debajo de la cuenta atrás, el dorsal, nombre y apellido del corredor actual. El tamaño del texto ha de ser 1/5 del tiempo del crono.

La opción de exportar, exportará el número de dorsal, nombre apellido, hora y tiempo real salida, hora y tiempo previsto de salida.

El inicio del crono que tengas tres opciones desde el primer corredor, desde el número del siguiente dorsal del último dorsal que salió o desde el dorsal que indique el usuario.
************************************
Realizar la parte gráfica de añadir la opción de Gestión del Orden de salida:
Estará después del bloque de Gestión de Carrera

Tendrá 4 bloques:
Bloque 1 - título - Orden de Salida
Bloque 2 - Hora Salida Primer Corredor (valor modificable), Hora del Día (sin titulo, solo mostrar la hora del sistema), diferencia entre estos dos tiempos (Hora de Salda+1min+hora del sistema - sin titulo) y Total Corredores.
Bloque 3 - Botones de Acción: Crear Plantilla Importación, Importar Orden Salida, Eliminar Orden de Salida,Exportar Orden de Salida y Añadir Corredor
Bloque 4 - Una tabla con el Orden de salida - Columnas: Orden, Dorsal, Crono Salida, Hora Salida, Nombre, Apellidos, Chip, Hora Salida Real, Crono Salida Real, Hora Salida Prevista, Crono Salida Prevista, Hora Salida Importado, Crono Salida Importado, Crono Salida Segundos, Hora Salida Segundos
Cada fila se podrá modificar, y las columnas se podran ordenar (de momento no programemos)


estamos trabajando muy bien en equipo para hacer el crono_cri, pero cada vez los procesos de cambios se vuelven muy complicados porque los ficheros estan muy grandes.
Creo que lo bueno seria trabajar con ficheros no muy grandes para que te los pueda enviar y los puedas analizar, pero si creamos muchos entonces yo pierdo el control de que ficheros te tengo que enviar para que tu tengas claro donde se han de hacer las modificaciones.
también seria interesante que en el inicio de estos archivos te pongas indicaciones que te ayuden a saber que si cambias algo sepas en que archivos estan y me los pidas. hay veces que me dices que una función se tiene que crear porque la llama una parte del archivo y no ves esa función en los arhivos que te envio.
Bajo mi punto de vista habria los siguientes siguiendo los criterios de cuando se realice un cambio tener que enviar el manor numero de ficheros, y que esos ficheros tengan un tamaño pequ´ño para facilitarme el envio a ti.

CRI_js_general.js - aquí estarían las funciones que van a ser llamadas por cualquier otra parte del programa con asiduidad, o que van  a ser necesitadas de cambiar (initapp,...)
CRI_js_traducciones - aquí estaria todo lo que tiene que ver con las traducciones - const translations = { es: {, pdateModalTexts() , updateLanguageUI() 
CRI_js_salidas - aquí todas las  funciones que tengan que ver con los procesos de salidas (orden de salida, cuenta atras, etc...)
CRI_js_llegadas - aquí todas las otras funciones que tengan que ver con las llegadas.

y ya tengo las dudas de si crear 
CRI_js_utilidades.js - para tener aquí todas aquellas funciones secundarias, que una vez definidas, es muy poco probable que se tengan que modificar cuando evolucionemos la app, por ejemplo los temas de sonido, etc...

CRI_js_UI.js - para aquellas funciones auxiliares de la interfaz gráfica.


Dime que te parece y que propuesta me haces.
crono_cri/
├── Crono_CRI_js_Main.js            # Punto de entrada principal - Configuración y estado global
├── Crono_CRI_js_Traducciones.js    # Traducciones y funciones de idioma
├── Crono_CRI_js_Salidas.js         # Todo el módulo de salidas
├── Crono_CRI_js_Llegadas.js        # Todo el módulo de llegadas
├── Crono_CRI_js_Ui.js              # Interfaces y componentes UI
├── Crono_CRI_js_Utils.js           # Utilidades generales (sonido, Excel, etc.)
└── Crono_CRI_js_Storage_Pwa.js     # Funciones de persistencia (localStorage) Funcionalidades PWA/Service Worker

seguido al grupo de orden de salida, habra la elección de si se va a estar en Modo Salida o Modo Llegadas.
Cuando se elija un modo, debajo aparecerá el contenido que expongo despues.

Dentro del Modo Salida Habrá la Configuración de Audio (mover el antiguo aqui), Ultimo Corredor en Salir y Salidas Registradas  (mover el antiguo aqui)
Al llegar Inicio Cuenta atrás en: a cero se activará la pantalla de cuenta atras que ya existe.

Dentro del modo de Llegadas habrá un Cronometro (Diferencia entre Hora actual del sistema-Hora Salida Primer Corredor:
) con un boton pulsador

estion carrera
copias de seuridad
generar pDF de salida

las columnas de la tabla orden de salida han de tener globos de ayuda:

Orden - posición en la que saldrá el corredor
Crono salida - Tiempo de Cronometro en el que saldrá el corredor. El programa utiliza este valor para dar las salidas.
Hora salida - hora prevista de salida, es información, no se utiliza.
Hora salida real - será la hora del dia en la que efectivamente salió el corredor.
Crono salida real - será la hora del crono en la que efectivamente salió el corredor.
Hora salida prevista - será la hora del dia en la que estava previsto que saliese el corredor. La variación vendra por si se modificó la hora de salida del corredor o la diferencia (si se cambia la hora de salida del primero no se modificará).
Crono salida prevista - será la hora del crono en la que estava previsto que saliese el corredor. La variación vendra por si se modificó la hora de salida del corredor o la diferencia (si se cambia la hora de salida del primero no se modificará).
Hora salida importado - será la hora del dia que estava en el excel que se importó.
Crono salida importado - será la hora del crono que estava en el excel que se importó.


quiero añadir dos campos más en el excel y la tabla de orden de salida y es la conversion a segundos de la hora real de salida y el crono real de salida, esas columnas se llamaran Crono Salida Real Segundos y Hora Salida Real Segundos

----
El programa de cri sera un programa para la ayuda para realizar Carreras de Contrareloj. Tendrá tres partes, gestión general, gestión salidas y gestión de llegadas 
En la gestión general, definiremos los datos comunes, esto es idioma, datos carrera y orden de salida.
En gestión de salidas, mostraremos el reloj de cuenta atrás y el listado de salidos.
En gestión de carreras, tendremos un cronómetro para saber la hora de llegada de cada corredor, importaremos tiempos de salida y por la diferencia entre llegada y salida obtendremos el tiempo de la crono y a partir de aquí tendremos una clasificación, que mostraremos en nuestro dispositivo o en pantalla externa. 
Otras consideraciones: Más adelante intentaremos que un dispositivo externo nos diga el dorsal y tiempo de cada corredor que llega o sale. El programa a base de importación/exportacion de Excel compartirá la información entre salidas y llegadas, que estarán en dispositivos diferentes.

en la importacion hay unos condicionantes si la Hora Salida Importado	Crono Salida Importado estan vacios, entonces lo rellenamos con Hora salida y con Crono salida, y lo mismo si Hora Salida Prevista	Crono Salida Prevista estan vacios
Al acabar la importación actulizas el total de corredores con el valor de los registros importados

Importado - valor cuando Importado
Prevista - valor que se puede cambiar una vez importado
Real - valor real

Crono-cri/
├── Crono_CRI.html
├── Crono_CRI_manifest.json
├── Crono_CRI.css
├── Crono_CRI.js
    Crono_CRI_ui.js
    Crono_CRI_utilidades.js
    Crono_CRI_traducciones.js
├── Crono_CRI_ws.js
├── Crono_CRI_192x192.png      # Icono 192x192
├── Crono_CRI_512x512.png      # Icono 512x512
├── Crono_CRI_maskable_192x192.png  # (Opcional)
├── Crono_CRI_maskable_512x512.png  # (Opcional)
├── audio/
│   ├── es_10.ogg
│   ├── es_5.ogg
│   └── ...
└── plantilla-cri.xlsx

scroll orden de salida mantener la cabecera
cuando editas datos de carrera crea una nueva

Para empezar vamos a dejar el programa tal y como esta, pero vamos a:

al introducir manualmente un corredor preguntamos si lo pone al principio o en que posición, en función donde vaya se calcula a los siguientes corredores su hora de salida teniendo en cuenta que el corredor añadido tendrá la diferencia igual al anterior corredor. y a la vez se actualiza el valor en segundos de lo que hemos modificado

al introducir un corredor si es el primero o posición 1, se le pone crono salida 00:00:00 y en hora de salida la salida prevista del primer corredor y al que ahora sera segundo registro le pones como valor de diferencia el del tercero. y vuelves a calcular el valor de crono salida como crono del anterior más el campo diferncia y hora salida como hora salida anterior mas diferencia. y ademas actualizas tambien con esos valores hora salida prevista y crono prevista

al introducir el ultimo corredor u otra posición ponemos como datos, el valor diferencia seria el valor del registro anterior, y sobre los valores anteriores añadimos la diferencia para crono salida, hora salida, y hora salida prevista y crono salida prevista, en hora salida importado y crono salda importado lo dejamos en blanco y convertimos a segundos crono salida y hora salida. Si hay registros depués del añadido recalculamos los tiempos de las mismas columnas, NO modificamos importado.


los unicos valores que se pueden modificar en la tabla de orden de salida son: dorsal,diferencia, nombre, apellidos, chip

te digo como lo quiero, primero el nombre de la prueba, debajo Orden de Salida, y esto centrado en la página, luego jusitificado (sin titulo) a la izquierda lugar, y al lado fecha, debajo tipo prueba y al lado categoria y Total Corredores: y su valor, al lado Salida Primer Corredor: y al lado Salida último Corredor. la cabecera de la tabla la quiero del mismo color que el ejemplo azul creo que es, y los titulos y valores de pos, dorsal, hora salida y crono centrado, y apellidos y nombre jsutificado izquierda, y automatiza el calculo del numero de registros que caben en una hoja

doc.setFillColor(230, 230, 230); // Gris medio