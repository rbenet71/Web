<!-- =========================================== -->
<!-- ARCHIVO: Crono_CRI.html -->
<!-- =========================================== -->
<!-- DESCRIPCIÓN: HTML principal de la aplicación Crono CRI -->
<!-- RESPONSABILIDADES:
   1. Estructura completa de la aplicación web
   2. Inclusión de todos los recursos externos (CSS, JS, bibliotecas)
   3. Definición de modales, tarjetas y componentes UI
   4. PWA: Metadatos para instalación como aplicación
   5. Integración con Google Analytics
   
ELEMENTOS PRINCIPALES:
   - Header con logo y selector de idioma
   - Tarjetas de configuración de carrera
   - Selector de modo Salida/Llegadas
   - Tabla de orden de salida (19 columnas)
   - Pantalla de cuenta atrás en pantalla completa
   - Footer con botones de utilidad
   - 15+ modales para diversas funcionalidades
   - Sistema de mensajes flotantes

TECNOLOGÍAS INCLUIDAS:
   - Font Awesome 6.4.0 (iconos)
   - XLSX 0.18.5 (exportación Excel)
   - jsPDF 3.5.1 (exportación PDF)
   - Google Analytics (G-CV925PMBQV)

ARCHIVOS RELACIONADOS:
   → Crono_CRI.css: Estilos principales
   → Crono_CRI_js_*.js: 8 archivos JavaScript modulares
   ← Todos los recursos externos CDN
   → Recursos locales (audio/, imágenes)
   
ESTRUCTURA MODULAR:
   - Main.js: Núcleo de la aplicación
   - Traducciones.js: Sistema multilingüe (4 idiomas)
   - Utilidades.js: Funciones generales
   - UI.js: Interfaz de usuario
   - Salidas_*.js: 4 módulos para gestión de salidas
   - Llegadas.js: Sistema de llegadas
   - Storage_Pwa.js: Almacenamiento y PWA
-->
<!-- =========================================== -->
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>Crono CRI - Control de Salidas para Carreras</title>
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CV925PMBQV"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-CV925PMBQV');
    </script>

    <!-- Iconos -->
    <link rel="icon" type="image/png" href="https://rbenet71.github.io/Web/Árbitro/Crono_CRI/Crono_CRI_192x192.png">
    <link rel="apple-touch-icon" href="https://rbenet71.github.io/Web/Árbitro/Crono_CRI/Crono_CRI_192x192.png">
    
    <!-- PWA -->
    <meta name="theme-color" content="#FF0000">
    <meta name="apple-mobile-web-app-title" content="Crono CRI">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="Crono_CRI.css">
</head>
<body>
    <!-- =========================================== -->
    <!-- HEADER -->
    <!-- =========================================== -->
    <header class="app-header hide-on-countdown">
        <div class="container">
            <div class="header-content">
                <div class="app-title">
                    <img src="https://rbenet71.github.io/Web/Árbitro/Crono_CRI/Crono_CRI_192x192.png" 
                         alt="Logo Crono CRI" 
                         class="app-logo">
                    <h1 id="app-title-text">Crono CRI</h1>
                </div>
                    <div class="header-controls">
                        <div class="language-selector">
                            <div class="languages-label" id="languages-label">Idioma / Language</div>
                            <img src="https://flagcdn.com/w40/es.png" class="flag active" id="flag-es" data-lang="es">
                            <img class="flag" src="https://upload.wikimedia.org/wikipedia/commons/c/ce/Flag_of_Catalonia.svg" id="flag-ca" data-lang="ca" style="width:25px">
                            <img src="https://flagcdn.com/w40/gb.png" class="flag" id="flag-en" data-lang="en">
                            <img src="https://flagcdn.com/w40/fr.png" class="flag" id="flag-fr" data-lang="fr">
                            <i class="fas fa-question-circle help-icon" id="help-icon-header" title="Ayuda"></i>
                        </div> <!-- Este cierra language-selector -->
                    </div>
            </div>
        </div>
    </header>

    <!-- =========================================== -->
    <!-- CONTENIDO PRINCIPAL - CONFIGURACIÓN -->
    <!-- =========================================== -->
    <main class="main-content hide-on-countdown">
        <div class="container">
            
            <!-- =========================================== -->
            <!-- Tarjeta 1: Gestión de carrera -->
            <!-- =========================================== -->
            <div class="app-card race-management-card">
                <div class="card-header">
                    <h2><i class="fas fa-flag-checkered"></i> <span id="card-race-title">Gestión de Carrera</span></h2>
                    <div class="card-header-controls">
                        <button class="card-toggle-btn" data-target="race-management-card" title="Minimizar/Expandir">
                            <i class="fas fa-chevron-up"></i>
                        </button>
                        <span class="card-collapse-indicator"><i class="fas fa-chevron-down"></i></span>
                    </div>
                </div>
                <div class="card-body">
                    <div class="race-selector">
                        <select id="race-select" class="form-control">
                            <option value="">-- Selecciona una carrera --</option>
                        </select>
                        <button class="btn btn-primary responsive-btn race-action-btn" id="new-race-btn">
                            <i class="fas fa-plus"></i>
                            <span class="race-btn-text" id="new-race-text">Nueva</span>
                        </button>
                        <button class="btn btn-danger responsive-btn race-action-btn" id="delete-race-btn">
                            <i class="fas fa-trash"></i>
                            <span class="race-btn-text" id="delete-race-text">Eliminar</span>
                        </button>
                        <button class="btn btn-secondary responsive-btn race-action-btn" id="edit-race-btn" title="Editar datos de la carrera">
                            <i class="fas fa-edit"></i>
                            <span class="race-btn-text" id="edit-race-text">Editar</span>
                        </button>
                        <!-- NUEVOS BOTONES DE COPIA DE SEGURIDAD -->
                        <button class="btn btn-info responsive-btn race-action-btn" id="backup-race-btn" title="Crear copia de seguridad">
                            <i class="fas fa-save"></i>
                            <span class="race-btn-text" id="backup-race-text">Copia Seguridad</span>
                        </button>
                        <button class="btn btn-warning responsive-btn race-action-btn" id="restore-race-btn" title="Restaurar desde copia">
                            <i class="fas fa-file-import"></i>
                            <span class="race-btn-text" id="restore-race-text">Restaurar</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- =========================================== -->
            <!-- SELECTOR DE MODO DE OPERACIÓN -->
            <!-- =========================================== -->
            <div class="app-card mode-selector-simple-card">
                <div class="card-header">
                    <h2><i class="fas fa-cogs"></i> <span id="mode-selector-title">Modo de Operación</span></h2>
                    <div class="card-header-controls">
                        <button class="card-toggle-btn" data-target="mode-selector-simple-card" title="Minimizar/Expandir">
                            <i class="fas fa-chevron-up"></i>
                        </button>
                        <span class="card-collapse-indicator"><i class="fas fa-chevron-down"></i></span>
                    </div>
                </div>
                <div class="card-body">
                    <div class="mode-slider-container">
                        <div class="mode-slider">
                            <div class="mode-slider-option active" data-mode="salida">
                                <span id="mode-salida-text">SALIDAS</span>
                            </div>
                            <div class="mode-slider-option" data-mode="llegadas">
                                <span id="mode-llegadas-text">LLEGADAS</span>
                            </div>
                            <div class="mode-slider-track"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- =========================================== -->
            <!-- NUEVA TARJETA: GESTIÓN DEL ORDEN DE SALIDA -->
            <!-- =========================================== -->
            <div class="app-card start-order-card">
                <div class="card-header">
                    <h2><i class="fas fa-list-ol"></i> <span id="card-start-order-title">Orden de Salida</span></h2>
                    <div class="card-header-controls">
                        <button class="card-toggle-btn" data-target="start-order-card" title="Minimizar/Expandir">
                            <i class="fas fa-chevron-up"></i>
                        </button>
                        <span class="card-collapse-indicator"><i class="fas fa-chevron-down"></i></span>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Bloque 1 - Configuración de horarios -->
                    <div class="config-section">
                        <div class="time-config-grid">
                            <div class="time-config-item">
                                <label for="first-start-time" class="form-label" id="first-start-label">Hora Salida Primer Corredor:</label>
                                <input type="text" id="first-start-time" class="form-control" 
       placeholder="HH:MM:SS" value="09:00:00">
                            </div>
                            <div class="time-config-item">
                                <label class="form-label" id="current-time-label">Hora del Sistema:</label>
                                <div class="time-display" id="current-system-time-display">00:00:00</div>
                            </div>
                            <div class="time-config-item">
                                <label class="form-label" id="time-diff-label">Inicio Cuenta atrás en:</label>
                                <div class="time-display" id="time-difference-display">00:00:00</div>
                            </div>
                            <div class="time-config-item">
                                <label for="total-riders" class="form-label" id="total-riders-label">Total Corredores:</label>
                                <input type="number" id="total-riders" class="form-control" min="1" value="1" readonly>
                            </div>
                        </div>
                    </div>
                    

                    <!-- Bloque 2 - Botones de acción -->
                    <div class="config-section">
                        <div class="buttons-responsive-container">
                            <button class="responsive-btn btn-primary" id="create-template-btn">
                                <i class="fas fa-file-excel"></i>
                                <span id="create-template-text">Crear Plantilla</span>
                            </button>
                            <button class="responsive-btn btn-success" id="import-order-btn">
                                <i class="fas fa-file-import"></i>
                                <span id="import-order-text">Importar Orden</span>
                            </button>
                            <button class="responsive-btn btn-danger" id="delete-order-btn">
                                <i class="fas fa-trash"></i>
                                <span id="delete-order-text">Eliminar Orden</span>
                            </button>
                            <button class="responsive-btn btn-warning" id="export-order-btn">
                                <i class="fas fa-file-excel"></i>
                                <span id="export-order-text">Exportar Excel</span>
                            </button>
                            <!-- NUEVO BOTÓN PARA EXPORTAR A PDF -->
                            <button class="responsive-btn btn-danger" id="export-order-pdf-btn">
                                <i class="fas fa-file-pdf"></i>
                                <span id="export-order-pdf-text">Exportar PDF</span>
                            </button>
                            <button class="responsive-btn btn-info" id="add-rider-btn">
                                <i class="fas fa-user-plus"></i>
                                <span id="add-rider-text">Añadir Corredor</span>
                            </button>
                            <button class="responsive-btn btn-danger" id="delete-rider-btn">
                                <i class="fas fa-user-minus"></i>
                                <span id="delete-rider-text">Eliminar Corredor</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Bloque 3 - Tabla de orden de salida -->
                    <div class="config-section">
                        <div class="section-title">
                            <i class="fas fa-table"></i>
                            <span id="order-table-label">Orden de Salida</span>
                        </div>
                        <div class="start-order-table-container" id="start-order-table-container">
                            <!-- CONTENEDOR CON SCROLL Y CABECERA FIJA -->
                            <div class="table-scroll-wrapper">
                                <table class="start-order-table" id="start-order-table">
                                    <thead>
                                        <tr>
                                            <th class="sortable" data-sort="order" id="orderHeader">Orden</th>
                                            <th class="sortable" data-sort="dorsal" id="dorsalHeader">Dorsal</th>
                                            <th class="sortable" data-sort="cronoSalida" id="cronoSalidaHeader">Crono Salida</th>
                                            <th class="sortable" data-sort="horaSalida" id="horaSalidaHeader">Hora Salida</th>
                                            <th class="sortable" data-sort="diferencia" id="diferenciaHeader">Diferencia</th>
                                            <th class="sortable" data-sort="nombre" id="nombreHeader">Nombre</th>
                                            <th class="sortable" data-sort="apellidos" id="apellidosHeader">Apellidos</th>
                                            <th class="sortable" data-sort="categoria" id="categoriaHeader">Categoría</th>
                                            <th class="sortable" data-sort="equipo" id="equipoHeader">Equipo</th>
                                            <th class="sortable" data-sort="licencia" id="licenciaHeader">Licencia</th>
                                            <th class="sortable" data-sort="chip" id="chipHeader">Chip</th>
                                            <th class="sortable" data-sort="horaSalidaReal" id="horaRealHeader">Hora Salida Real</th>
                                            <th class="sortable" data-sort="cronoSalidaReal" id="cronoRealHeader">Crono Salida Real</th>
                                            <th class="sortable" data-sort="horaSalidaPrevista" id="horaPrevistaHeader">Hora Salida Prevista</th>
                                            <th class="sortable" data-sort="cronoSalidaPrevista" id="cronoPrevistaHeader">Crono Salida Prevista</th>
                                            <th class="sortable" data-sort="horaSalidaImportado" id="horaImportadoHeader">Hora Salida Importado</th>
                                            <th class="sortable" data-sort="cronoSalidaImportado" id="cronoImportadoHeader">Crono Salida Importado</th>
                                            <th class="sortable" data-sort="cronoSegundos" id="cronoSegundosHeader">Crono Segundos</th>
                                            <th class="sortable" data-sort="horaSegundos" id="horaSegundosHeader">Hora Segundos</th>
                                            <th class="sortable" data-sort="cronoSalidaRealSegundos" id="cronoRealSegundosHeader">Crono Salida Real Segundos</th>
                                            <th class="sortable" data-sort="horaSalidaRealSegundos" id="horaRealSegundosHeader">Hora Salida Real Segundos</th>
                                        </tr>
                                    </thead>
                                    <tbody id="start-order-table-body">
                                        <!-- Las filas se agregarán aquí dinámicamente -->
                                    </tbody>
                                </table>
                            </div>
                            <div id="start-order-empty" class="empty-state" style="display: none;">
                                <i class="fas fa-users"></i>
                                <p id="no-start-order-text">No hay corredores en el orden de salida</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <!-- =========================================== -->
            <!-- CONTENIDO DEL MODO SALIDA -->
            <!-- =========================================== -->
            <div id="mode-salida-content" class="mode-content active">

                <!-- Tarjeta de Configuración de Audio (Modo Salida) -->
                <div class="app-card audio-config-card">
                    <div class="card-header">
                        <h2><i class="fas fa-volume-up"></i> <span id="audio-config-title">Configuración de Audio para Salidas</span></h2>
                        <div class="card-header-controls">
                            <button class="card-toggle-btn" data-target="audio-config-card" title="Minimizar/Expandir">
                                <i class="fas fa-chevron-up"></i>
                            </button>
                            <span class="card-collapse-indicator"><i class="fas fa-chevron-down"></i></span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="config-section">
                            <div class="audio-config-section">
                                <div class="audio-options" id="audio-options">
                                    <div class="audio-option active" 
                                        data-audio-type="beep"
                                        title="Beeps electrónicos para cada segundo">
                                        <i class="fas fa-bell"></i>
                                        <div class="option-title" id="beep-option-title">Sonidos Beep</div>
                                    </div>
                                    
                                    <div class="audio-option" 
                                        data-audio-type="voice"
                                        title="Voz humana contando en tu idioma">
                                        <i class="fas fa-microphone-alt"></i>
                                        <div class="option-title" id="voice-option-title">Voz grabada</div>
                                    </div>
                                    
                                    <div class="audio-option" 
                                        data-audio-type="none"
                                        title="Solo efectos visuales">
                                        <i class="fas fa-volume-mute"></i>
                                        <div class="option-title" id="mute-option-title">Sin sonido</div>
                                    </div>
                                </div>
                                
                                <div style="text-align: center; margin-top: 15px;">
                                    <button class="audio-test-btn" id="test-audio-btn">
                                        <i class="fas fa-play-circle"></i>
                                        <span id="test-audio-text">Probar sonido actual</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tarjeta de Inicio Cuenta Atrás -->
                <div class="app-card start-control-card">
                    <div class="card-header">
                        <h2><i class="fas fa-hand-pointer"></i> <span id="start-control-title">Inicio Cuenta Atrás</span></h2>
                        <div class="card-header-controls">
                            <button class="card-toggle-btn" data-target="start-control-card" title="Minimizar/Expandir">
                                <i class="fas fa-chevron-up"></i>
                            </button>
                            <span class="card-collapse-indicator"><i class="fas fa-chevron-down"></i></span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="config-section">
                            <!-- Grid para controles principales -->
                            <div class="time-config-grid">
                                <!-- 1. Hora actual del sistema -->
                                <div class="time-config-item">
                                    <label class="form-label" id="current-time-label">Hora del Sistema:</label>
                                    <div class="time-display" id="current-system-time">00:00:00</div>
                                </div>
                                
                                <!-- 2. Tiempo previo de cuenta atrás (NUEVO) -->
                                <div class="time-config-item">
                                    <label for="pre-countdown-time" class="form-label" id="pre-countdown-label">Tiempo Previo:</label>
                                    <input type="text" id="pre-countdown-time" class="form-control time-input" 
                                        placeholder="HH:MM:SS" value="00:01:00">
                                </div>
                                
                                <!-- 3. Posición a Salir (ya existe) -->
                                <div class="time-config-item">
                                    <label for="start-position" class="form-label" id="position-label">Posición a Salir:</label>
                                    <input type="number" id="start-position" class="form-control" min="1" value="1">
                                </div>
                                
                                <!-- 4. Dorsal a Salir (NUEVO - para sincronización) -->
                                <div class="time-config-item">
                                    <label for="manual-dorsal" class="form-label" id="dorsal-label">Dorsal a Salir:</label>
                                    <input type="number" id="manual-dorsal" class="form-control" min="0" value="0">
                                </div>
                            </div>
                            
                            <!-- Botones con diseño mejorado -->
                            <div class="manual-buttons-grid" style="margin-top: 25px; gap: 15px;">
                                <button class="btn btn-success btn-lg" id="start-countdown-btn" style="flex: 1;">
                                    <i class="fas fa-rocket"></i>
                                    <span id="start-countdown-text">INICIAR CUENTA ATRÁS</span>
                                </button>
                                
                                <button class="btn btn-danger btn-lg" id="exit-complete-btn" style="flex: 1;">
                                    <i class="fas fa-redo"></i>
                                    <span id="exit-complete-text">REINICIAR TODO</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div> 

            <!-- =========================================== -->
            <!-- CONTENIDO DEL MODO LLEGADAS -->
            <!-- =========================================== -->
            <div id="mode-llegadas-content" class="mode-content">
                <!-- Cronómetro principal (Modo Llegadas) -->
                <div class="app-card llegadas-timer-card">
                    <div class="card-header">
                        <div class="card-header-controls">
                            <button class="card-toggle-btn" data-target="llegadas-timer-card" title="Minimizar/Expandir">
                                <i class="fas fa-chevron-up"></i>
                            </button>
                            <span class="card-collapse-indicator"><i class="fas fa-chevron-down"></i></span>
                        </div>
                        <h2><i class="fas fa-stopwatch"></i> 
                            <span id="llegadas-timer-title">Cronómetro de Llegadas</span>
                            <span id="llegadas-timer-compact" style="font-size: 0.9em; margin-left: 10px; color: #666; display: none;"></span>
                        </h2>
                    </div>
                    <div class="card-body">
                        <div class="llegadas-main-timer">
                            <div class="llegadas-timer-label" id="llegadas-timer-label">
                                Tiempo desde salida del primer corredor:
                            </div>
                            <div class="llegadas-timer-display" id="llegadas-timer-display">00:00:00</div>
                            
                            <div class="llegadas-controls">
                                <button class="btn btn-primary" id="registerLlegadaBtn">
                                    <i class="fas fa-user-check"></i>
                                    <span id="registerLlegadaText">Registrar Llegada</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Tabla de llegadas registradas (Modo Llegadas) -->
                <div class="app-card llegadas-list-card">
                    <div class="card-header">
                        <div class="card-header-controls">
                            <button class="card-toggle-btn" data-target="llegadas-list-card" title="Minimizar/Expandir">
                                <i class="fas fa-chevron-up"></i>
                            </button>
                            <span class="card-collapse-indicator"><i class="fas fa-chevron-down"></i></span>
                        </div>
                        <h2><i class="fas fa-list-ol"></i> 
                            <!-- Texto fijo + contador dinámico - VERSIÓN 3.5.1.1 -->
                            <span id="llegadas-list-title-static">Llegadas Registradas</span>
                            <span id="llegadas-list-counter" style="font-size: 0.9em; margin-left: 10px; color: #666;"></span>
                        </h2>
                    </div>
                    <div class="card-body">
                        <div class="llegadas-table-container">
                            <!-- REEMPLAZAR LA SECCIÓN COMPLETA CON ESTA -->
                            <table class="llegadas-table" id="llegadas-table">
                                <thead>
                                    <tr>
                                        <!-- ORDEN DE 14 COLUMNAS (13 + posición por categoría) - VERSIÓN 3.3.5.1 -->
                                        <th class="sortable" data-sort="dorsal" id="dorsalHeader">Dorsal</th>
                                        <th class="sortable" data-sort="cronoLlegada" id="cronoLlegadaHeader">Crono Llegada</th>
                                        <th class="sortable" data-sort="tiempoFinal" id="tiempoFinalHeader">Tiempo Final</th>
                                        <!-- COLUMNA 3.3.5.1 - POSICIÓN GENERAL -->
                                        <th class="sortable" data-sort="position" id="positionHeader">Posición</th>
                                        <th class="sortable" data-sort="nombre" id="nombreHeader">Nombre</th>
                                        <th class="sortable" data-sort="apellidos" id="apellidosHeader">Apellidos</th>
                                        <!-- NUEVA COLUMNA 3.3.5.1 - POSICIÓN POR CATEGORÍA -->
                                        <th class="sortable" data-sort="posCat" id="posCatHeader">Pos. Cat.</th>
                                        <th class="sortable" data-sort="categoria" id="categoriaHeader">Categoría</th>
                                        <th class="sortable" data-sort="cronoSalida" id="cronoSalidaHeader">Crono Salida</th>
                                        <th class="sortable" data-sort="horaLlegada" id="horaLlegadaHeader">Hora Llegada</th>
                                        <th class="sortable" data-sort="horaSalida" id="horaSalidaHeader">Hora Salida</th>
                                        <th class="sortable" data-sort="chip" id="chipHeader">Chip</th>
                                        <th class="sortable" data-sort="equipo" id="equipoHeader">Equipo</th>
                                        <th class="sortable" data-sort="licencia" id="licenciaHeader">Licencia</th>
                                    </tr>
                                </thead>
                                <tbody id="llegadas-table-body">
                                    <!-- Las filas se agregarán aquí dinámicamente -->
                                </tbody>
                            </table>
                            <div id="llegadas-empty" class="empty-state">
                                <i class="fas fa-clock"></i>
                                <p id="no-llegadas-text">No hay llegadas registradas</p>
                            </div>
                        </div>
                        
                        <div class="llegadas-actions" style="margin-top: 20px; display: flex; gap: 15px; flex-wrap: wrap;">
                            <!-- Botón Limpiar Llegadas -->
                            <button class="btn btn-danger" id="clearLlegadasBtn">
                                <i class="fas fa-broom"></i>
                                <span id="clearLlegadasText">Limpiar llegadas</span>
                            </button>
                            
                            <!-- Botón Exportar Excel -->
                            <button class="btn btn-success" id="exportLlegadasBtn">
                                <i class="fas fa-file-excel"></i>
                                <span id="exportLlegadasText">Exportar Excel</span>
                            </button>
                            
                            <!-- Botón Ver Clasificación -->
                            <button class="btn btn-info" id="showRankingBtn">
                                <i class="fas fa-trophy"></i>
                                <span id="showRankingText">Ver Clasificación</span>
                            </button>
                            
                            <!-- NUEVO: Botón Clasificación PDF -->
                            <button class="btn btn-danger" id="exportRankingPdfDirectBtn">
                                <i class="fas fa-file-pdf"></i>
                                <span id="exportRankingPdfDirectText">Clasificación PDF</span>
                            </button>
                            <!-- NUEVO: Botón Pantalla Externa (INICIALMENTE OCULTO) -->
                            <button class="btn btn-warning" id="external-screen-btn" style="display: none;">
                                <i class="fas fa-external-display-alt"></i>
                                <span id="external-screen-text">Pantalla Externa</span>
                            </button>
                        </div>
                    </div>
                </div>
                <!-- Botón flotante para registro rápido -->
                <button class="quick-register-btn" id="quickRegisterBtn" title="Registrar llegada rápida">
                    <i class="fas fa-flag-checkered"></i>
                </button>
            </div>
        </div>
    </main>

    <!-- =========================================== -->
    <!-- PANTALLA DE EJECUCIÓN (REDISEÑADA) -->
    <!-- =========================================== -->
    <div class="countdown-screen" id="countdown-screen">
        <div class="config-toggle" id="config-toggle">
            <i class="fas fa-cog"></i>
        </div>

        <div class="countdown-container">
            <div class="countdown-label" id="countdown-label">Salida en</div>
            <div class="countdown-display" id="countdown-display">60</div>
        </div>

        <div class="info-corner top-left">
            <span class="info-label" id="total-time-label">Tiempo total</span>
            <div class="info-value" id="total-time-value">00:00:00</div>
            <div class="info-value" id="current-time-value">00:00:00</div>
        </div>
        
        <div class="info-corner bottom-left">
            <span class="info-label" id="next-corredor-label">Próximo sale a</span>
            <div class="info-value inline-edit" id="next-corredor-time">1:00</div>
        </div>
        
        <div class="info-corner bottom-right">
            <span class="info-label" id="departed-label">Salidos</span>
            <div class="info-value inline-edit" id="departed-count">0</div>
        </div>

        <div class="salida-display" id="salida-display">SALIDA</div>
    </div>

    <!-- =========================================== -->
    <!-- FOOTER -->
    <!-- =========================================== -->
    <footer class="app-footer hide-on-countdown">
        <div class="container">
            <div class="footer-content">
                <div class="footer-left">
                    <button class="footer-btn" id="footer-help-btn">
                        <i class="fas fa-question-circle"></i>
                        <span id="help-text">Ayuda</span>
                    </button>
                    <button class="footer-btn" id="suggestions-btn">
                        <i class="fas fa-lightbulb"></i>
                        <span id="suggestions-text">Sugerencias</span>
                    </button>
                    <button class="footer-btn" id="install-btn">
                        <i class="fas fa-download"></i>
                        <span id="install-text">Instalar App</span>
                    </button>
                    <button class="footer-btn" id="update-btn">
                        <i class="fas fa-sync-alt"></i>
                        <span id="update-text">Buscar actualizaciones</span>
                    </button>
                </div>
                    <div class="copyright" id="copyright-text">
                        2026 © Copyright 
                        <a href="https://rbenet71.github.io/Web/" target="_blank" id="copyright-link"
                        style="color: rgb(58, 192, 5); text-decoration: none;">
                            Roberto Benet - rbenet71@gmail.com - Ver: 3.5.1
                        </a>
                    </div>
            </div>
        </div>
    </footer>

    <!-- =========================================== -->
    <!-- MODALES -->
    <!-- =========================================== -->

    <!-- Modal para Editar Carrera -->
    <div id="edit-race-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> <span id="edit-race-modal-title">Editar Carrera</span></h3>
                <button id="edit-race-modal-close" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="edit-race-name">Nombre de la carrera *</label>
                    <input type="text" id="edit-race-name" class="form-control" 
                        placeholder="Ej: Media Maratón Ciudad" maxlength="100">
                </div>
                
                <div class="form-group">
                    <label for="edit-race-category">Categoría</label>
                    <input type="text" id="edit-race-category" class="form-control" 
                        placeholder="Ej: Élite, Máster 40, etc." maxlength="50">
                </div>
                
                <div class="form-group">
                    <label for="edit-race-organizer">Organizador</label>
                    <input type="text" id="edit-race-organizer" class="form-control" 
                        placeholder="Club, federación..." maxlength="100">
                </div>
                
                <div class="form-group">
                    <label for="edit-race-location">Ubicación</label>
                    <input type="text" id="edit-race-location" class="form-control" 
                        placeholder="Ej: Parque Central" maxlength="100">
                </div>
                
                <div class="form-group">
                    <label for="edit-race-date">Fecha</label>
                    <input type="date" id="edit-race-date" class="form-control">
                </div>
                
                <!-- Modalidad -->
                <div class="form-group">
                    <label>Modalidad:</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="edit-modality" id="edit-modality-cri" value="CRI" checked>
                            <span class="radio-label">CRI</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="edit-modality" id="edit-modality-cre" value="CRE">
                            <span class="radio-label">CRE</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="edit-modality" id="edit-modality-descenso" value="Descenso">
                            <span class="radio-label">Descenso</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="edit-modality" id="edit-modality-otras" value="Otras">
                            <span class="radio-label">Otras</span>
                        </label>
                    </div>
                    <div id="edit-other-modality-container" class="form-group" style="display: none; margin-top: 10px;">
                        <input type="text" id="edit-race-other-modality" class="form-control" 
                            placeholder="Especifica la modalidad..." maxlength="50">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="edit-race-description">Descripción / Notas</label>
                    <textarea id="edit-race-description" class="form-control" rows="3" 
                            placeholder="Información adicional sobre la carrera..."></textarea>
                </div>
                
                <!-- ⭐ NUEVO 3.5.1.1: Logos para PDF -->
                <div class="form-group">
                    <label>Logos para PDF:</label>
                    <div class="logos-container" style="display: flex; gap: 20px; margin-top: 10px;">
                        <!-- Logo izquierdo -->
                        <div class="logo-upload" style="flex: 1;">
                            <label for="edit-race-logo-left" class="logo-label" style="display: block; margin-bottom: 5px; font-weight: 500;">
                                <i class="fas fa-image"></i> <span id="logo-left-label-text">Logo Izquierdo</span>
                            </label>
                            <input type="file" 
                                id="edit-race-logo-left" 
                                class="form-control logo-input"
                                accept=".png,.jpg,.jpeg,.svg"
                                style="padding: 6px; font-size: 0.9rem;">
                            <div class="logo-info" style="font-size: 0.8rem; color: #6c757d; margin-top: 5px;">
                                <span id="edit-race-logo-left-info" data-default="PNG, JPG, SVG (máx. 5MB)">PNG, JPG, SVG (máx. 5MB)</span>
                            </div>
                        </div>
                        
                        <!-- Logo derecho -->
                        <div class="logo-upload" style="flex: 1;">
                            <label for="edit-race-logo-right" class="logo-label" style="display: block; margin-bottom: 5px; font-weight: 500;">
                                <i class="fas fa-image"></i> <span id="logo-right-label-text">Logo Derecho</span>
                            </label>
                            <input type="file" 
                                id="edit-race-logo-right" 
                                class="form-control logo-input"
                                accept=".png,.jpg,.jpeg,.svg"
                                style="padding: 6px; font-size: 0.9rem;">
                            <div class="logo-info" style="font-size: 0.8rem; color: #6c757d; margin-top: 5px;">
                                <span id="edit-race-logo-right-info" data-default="PNG, JPG, SVG (máx. 5MB)">PNG, JPG, SVG (máx. 5MB)</span>
                            </div>
                        </div>
                    </div>
                    <div style="font-size: 0.8rem; color: #6c757d; margin-top: 10px;">
                        <i class="fas fa-info-circle"></i> <span id="logo-info-tooltip-text">Los logos aparecerán en los PDFs generados</span>
                    </div>
                </div>
                
                <!-- Información de creación -->
                <div class="creation-info" style="font-size: 0.85rem; color: #6c757d; margin-top: 20px; padding-top: 10px; border-top: 1px solid #eee;">
                    <p><i class="fas fa-calendar-plus"></i> Creada: <span id="edit-race-created-at"></span></p>
                    <p><i class="fas fa-edit"></i> Última modificación: <span id="edit-race-last-modified"></span></p>
                </div>
            </div>
            <div class="modal-footer">
                <button id="save-edit-race-btn" class="btn btn-success">
                    <i class="fas fa-save"></i> Guardar Cambios
                </button>
                <button id="cancel-edit-race-btn" class="btn btn-danger">
                    <i class="fas fa-times"></i> Cancelar
                </button>
            </div>
        </div>
    </div>
    
    <!-- Modal de configuración de plantilla -->
    <div id="template-config-modal" class="modal">
        <div class="modal-content medium-modal">
            <div class="modal-header">
                <h3>Configurar Plantilla de Salida</h3>
                <span id="template-config-modal-close" class="modal-close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="template-num-corredores">Número de corredores:</label>
                    <input type="number" id="template-num-corredores" 
                        min="1" max="1000" value="10" 
                        class="form-control">
                </div>
                
                <div class="form-group">
                    <label for="template-intervalo">Intervalo entre salidas (HH:MM:SS):</label>
                    <input type="text" id="template-intervalo" 
                        value="00:01:00" 
                        placeholder="00:01:00"
                        class="form-control" 
                        pattern="[0-9]{2}:[0-9]{2}:[0-9]{2}">
                    <small class="form-text">Ej: 00:01:00 para 1 minuto, 00:02:30 para 2 minutos y 30 segundos</small>
                </div>
                
                <div class="form-group">
                    <label for="template-hora-inicio">Hora de inicio (HH:MM:SS):</label>
                    <input type="text" id="template-hora-inicio" 
                        value="09:00:00" 
                        placeholder="09:00:00"
                        class="form-control" 
                        pattern="[0-9]{2}:[0-9]{2}:[0-9]{2}">
                    <small class="form-text">Ej: 09:00:00 para las 9 de la mañana</small>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancel-template-btn" class="btn btn-secondary">Cancelar</button>
                <button id="generate-template-btn" class="btn btn-primary">Generar Plantilla</button>
            </div>
        </div>
    </div>

    <!-- Modal de confirmación reiniciar/salir -->
    <div class="modal" id="restart-confirm-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="restart-modal-title">Confirmar reinicio completo</h3>
                <button class="modal-close" id="restart-modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p id="restart-modal-text">¿Estás seguro de que quieres reiniciar todo el sistema? Esta acción:</p>
                <ul style="margin: 15px 0; padding-left: 20px;">
                    <li><strong>Detendrá la cuenta atrás</strong> si está activa</li>
                    <li><strong>Borrará todos los tiempos de salida reales</strong> de los corredores</li>
                    <li><strong>Reiniciará el contador de corredores salidos</strong> a cero</li>
                    <li><strong>Reiniciará el cronómetro de carrera</strong> a 00:00:00</li>
                    <li><strong>Volverá al primer corredor</strong> en la lista</li>
                    <li><strong>Reiniciará la posición y dorsal</strong> de inicio manual</li>
                </ul>
                <p style="color: var(--danger); font-weight: 600;">
                    ⚠️ Los tiempos de salida reales se perderán permanentemente.
                </p>
                <p style="color: var(--warning); font-style: italic;">
                    Nota: Esto NO afecta al orden de salida ni a los tiempos previstos.
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" id="restart-confirm-btn">
                    <i class="fas fa-redo"></i> Sí, reiniciar completamente
                </button>
                <button class="btn btn-secondary" id="restart-cancel-btn">
                    <i class="fas fa-times"></i> Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de configuración durante cuenta atrás -->
    <div class="modal" id="config-during-countdown-modal">
        <div class="modal-content config-modal-during-countdown">
            <div class="modal-header">
                <h3>Configuración</h3>
                <button class="modal-close" id="config-during-countdown-close">&times;</button>
            </div>
            <div class="modal-body">
                <p>La cuenta atrás continúa en segundo plano.</p>
                <div class="modal-buttons-container">
                    <button class="btn btn-success" id="resume-countdown-btn">
                        <i class="fas fa-play"></i> Continuar viendo
                    </button>
                    <button class="btn btn-warning" id="stop-countdown-btn">
                        <i class="fas fa-stop"></i> Detener cuenta atrás
                    </button>
                    <!-- <button class="btn btn-primary" id="adjust-times-btn">
                        <i class="fas fa-edit"></i> Ajustar tiempos
                    </button>-->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de ajuste de tiempos -->
    <div class="modal" id="adjust-times-modal">
        <div class="modal-content config-modal-during-countdown">
            <div class="modal-header">
                <h3>Ajustar Tiempos</h3>
                <button class="modal-close" id="adjust-times-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="config-line" style="flex-direction: column; align-items: stretch;">
                    <label for="adjust-next-time">Próximo tiempo (segundos):</label>
                    <input type="number" id="adjust-next-time" class="config-input" min="1" value="60">
                </div>
                <div class="config-line" style="flex-direction: column; align-items: stretch;">
                    <label for="adjust-departed">Corredores salidos:</label>
                    <input type="number" id="adjust-departed" class="config-input" min="0" value="0">
                </div>
                <div class="modal-buttons-container">
                    <button class="btn btn-success" id="save-adjustments-btn">
                        <i class="fas fa-save"></i> Guardar ajustes
                    </button>
                    <button class="btn" id="cancel-adjustments-btn">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de confirmación eliminar carrera -->
    <div class="modal" id="delete-race-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="delete-race-modal-title">Confirmar eliminación</h3>
                <button class="modal-close" id="delete-race-modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p id="delete-race-modal-text">¿Estás seguro de que quieres eliminar esta carrera?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" id="delete-race-confirm-btn">Eliminar</button>
                <button class="btn" id="delete-race-cancel-btn">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal de nueva carrera -->
    <div class="modal" id="new-race-modal">
        <div class="modal-content medium-modal">
            <div class="modal-header">
                <h3 id="new-race-modal-title">Nueva carrera</h3>
                <button class="modal-close" id="new-race-modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="race-form-container">
                    <div class="form-section">
                        <h4><i class="fas fa-info-circle"></i> Información básica</h4>
                        <div class="form-group">
                            <label for="new-race-name" id="new-race-name-label">Nombre de la carrera*:</label>
                            <input type="text" 
                                id="new-race-name" 
                                class="form-control config-input" 
                                placeholder="Ej: Carrera MTB 2025"
                                maxlength="100"
                                required>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group half-width">
                                <label for="new-race-date" id="new-race-date-label">Fecha de la carrera:</label>
                                <input type="date" id="new-race-date" value="" required>
                            </div>
                            
                            <div class="form-group half-width">
                                <label for="new-race-category" id="new-race-category-label">Categoría:</label>
                                <select id="new-race-category" class="form-control config-input">
                                    <option value="">-- Selecciona categoría --</option>
                                    <option value="Elite">Élite</option>
                                    <option value="Master">Master</option>
                                    <option value="Junior">Junior</option>
                                    <option value="Cadete">Cadete</option>
                                    <option value="Infantil">Infantil</option>
                                    <option value="Femenino">Femenino</option>
                                    <option value="Mixto">Mixto</option>
                                    <option value="Aficionado">Aficionado</option>
                                    <option value="Otro">Otro</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h4><i class="fas fa-users"></i> Organización</h4>
                        <div class="form-group">
                            <label for="new-race-organizer" id="new-race-organizer-label">Organizador/Club:</label>
                            <input type="text" 
                                id="new-race-organizer" 
                                class="form-control config-input" 
                                placeholder="Ej: Club Ciclista Local"
                                maxlength="100">
                        </div>
                        
                        <div class="form-group">
                            <label for="new-race-location" id="new-race-location-label">Población/Lugar:</label>
                            <input type="text" 
                                id="new-race-location" 
                                class="form-control config-input" 
                                placeholder="Ej: Barcelona, Montaña X"
                                maxlength="100">
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h4><i class="fas fa-flag-checkered"></i> Modalidad de carrera</h4>
                        <div class="modality-options">
                            <div class="modality-option">
                                <input type="radio" id="modality-cri" name="modality" value="CRI" checked>
                                <label for="modality-cri">
                                    <i class="fas fa-stopwatch"></i>
                                    <span>CRI (Contrarreloj Individual)</span>
                                </label>
                            </div>
                            <div class="modality-option">
                                <input type="radio" id="modality-cre" name="modality" value="CRE">
                                <label for="modality-cre">
                                    <i class="fas fa-users"></i>
                                    <span>CRE (Contrarreloj por Equipos)</span>
                                </label>
                            </div>
                            <div class="modality-option">
                                <input type="radio" id="modality-descenso" name="modality" value="Descenso">
                                <label for="modality-descenso">
                                    <i class="fas fa-mountain"></i>
                                    <span>Descenso (Downhill)</span>
                                </label>
                            </div>
                            <div class="modality-option">
                                <input type="radio" id="modality-otras" name="modality" value="Otras">
                                <label for="modality-otras">
                                    <i class="fas fa-ellipsis-h"></i>
                                    <span>Otras modalidades</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group" id="other-modality-container" style="display: none;">
                            <label for="new-race-other-modality" id="new-race-other-modality-label">Especificar modalidad:</label>
                            <input type="text" 
                                id="new-race-other-modality" 
                                class="form-control config-input" 
                                placeholder="Ej: Maratón, Enduro, XCO..."
                                maxlength="50">
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h4><i class="fas fa-file-alt"></i> Información adicional</h4>
                        <div class="form-group">
                            <label for="new-race-description" id="new-race-desc-label">Descripción/Notas:</label>
                            <textarea id="new-race-description" 
                                class="form-control config-input" 
                                rows="4" 
                                placeholder="Información adicional sobre la carrera, recorrido, normas especiales..."
                                maxlength="500"></textarea>
                        </div>
                    </div>
                    
                    <!-- ⭐ NUEVO 3.5.1.1: Logos para PDF (nueva carrera) -->
                    <div class="form-section">
                        <h4><i class="fas fa-images"></i> Logos para PDF</h4>
                        <div class="logos-container" style="display: flex; gap: 20px; margin-top: 10px;">
                            <!-- Logo izquierdo -->
                            <div class="logo-upload" style="flex: 1;">
                                <label for="new-race-logo-left" class="logo-label" style="display: block; margin-bottom: 5px; font-weight: 500;">
                                    <i class="fas fa-image"></i> <span id="new-logo-left-label-text">Logo Izquierdo</span>
                                </label>
                                <input type="file" 
                                    id="new-race-logo-left" 
                                    class="form-control config-input logo-input"
                                    accept=".png,.jpg,.jpeg,.svg"
                                    style="padding: 6px; font-size: 0.9rem;">
                                <div class="logo-info" style="font-size: 0.8rem; color: #6c757d; margin-top: 5px;">
                                    <span id="new-race-logo-left-info" data-default="PNG, JPG, SVG (máx. 5MB)">PNG, JPG, SVG (máx. 5MB)</span>
                                </div>
                            </div>
                            
                            <!-- Logo derecho -->
                            <div class="logo-upload" style="flex: 1;">
                                <label for="new-race-logo-right" class="logo-label" style="display: block; margin-bottom: 5px; font-weight: 500;">
                                    <i class="fas fa-image"></i> <span id="new-logo-right-label-text">Logo Derecho</span>
                                </label>
                                <input type="file" 
                                    id="new-race-logo-right" 
                                    class="form-control config-input logo-input"
                                    accept=".png,.jpg,.jpeg,.svg"
                                    style="padding: 6px; font-size: 0.9rem;">
                                <div class="logo-info" style="font-size: 0.8rem; color: #6c757d; margin-top: 5px;">
                                    <span id="new-race-logo-right-info" data-default="PNG, JPG, SVG (máx. 5MB)">PNG, JPG, SVG (máx. 5MB)</span>
                                </div>
                            </div>
                        </div>
                        <div style="font-size: 0.8rem; color: #6c757d; margin-top: 10px;">
                            <i class="fas fa-info-circle"></i> <span id="new-logo-info-tooltip-text">Los logos aparecerán en los PDFs generados</span>
                        </div>
                    </div>
                    
                    <div class="form-section" style="background: #f8f9fa; padding: 15px; border-radius: var(--border-radius); margin-top: 20px;">
                        <p style="font-size: 0.9rem; color: var(--gray); margin: 0;">
                            <i class="fas fa-info-circle"></i> Los campos marcados con * son obligatorios.
                        </p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success" id="create-race-btn">Crear carrera</button>
                <button class="btn" id="cancel-create-race-btn">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal de sugerencias - AÑADIR AL FINAL DEL BODY -->
    <div class="modal" id="suggestions-modal">
        <div class="modal-content medium-modal">
            <div class="modal-header">
                <h3><i class="fas fa-lightbulb"></i> <span id="suggestions-modal-title">Sugerencias para Crono CRI</span></h3>
                <button class="modal-close" id="suggestions-modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="suggestion-form">
                    <div class="form-group">
                        <label for="email-suggestions" id="email-suggestions-label">
                            Facilítanos tu email para mantenerte informado de las actualizaciones *
                        </label>
                        <input type="email" 
                            id="email-suggestions" 
                            class="form-control config-input" 
                            placeholder="tu@email.com"
                            required>
                    </div>
                    
                    <div class="form-group">
                        <label for="city-suggestions" id="city-suggestions-label">
                            Ciudad *
                        </label>
                        <input type="text" 
                            id="city-suggestions" 
                            class="form-control config-input" 
                            placeholder="Ej: Madrid"
                            required>
                        <small class="form-text" id="city-examples-text">Madrid, Barcelona, Valencia, etc.</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="suggestion-text" id="suggestion-text-label">
                            Sugerencias para mejorar la aplicación
                        </label>
                        <textarea id="suggestion-text" 
                                class="form-control config-input" 
                                rows="4" 
                                placeholder="Tus ideas para mejorar Crono CRI..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label id="program-label">Programa</label>
                        <div class="prefilled-field" id="program-value">Crono CRI</div>
                    </div>
                    
                    <!-- Loading spinner -->
                    <div class="loading" id="loading-suggestions" style="display: none;">
                        <div class="spinner"></div>
                        <p id="loading-suggestions-text">Enviando sugerencia...</p>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success" id="send-suggestion-btn">
                    <i class="fas fa-paper-plane"></i> <span id="send-suggestion-text">Enviar Sugerencia</span>
                </button>
                <button class="btn btn-secondary" id="cancel-suggestion-btn">
                    <i class="fas fa-times"></i> <span id="cancel-suggestion-text">Cancelar</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para registro de llegada -->
    <div class="modal" id="register-llegada-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="register-llegada-modal-title">Registrar Llegada</h3>
                <button class="modal-close" id="register-llegada-modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="llegada-form">
                    <div class="config-line" style="flex-direction: column; align-items: stretch;">
                        <label for="llegada-dorsal" id="llegada-dorsal-label">Dorsal del corredor:</label>
                        <input type="number" id="llegada-dorsal" class="config-input" min="1" placeholder="Ej: 101">
                    </div>
                    <div class="config-line" style="flex-direction: column; align-items: stretch;">
                        <label for="llegada-hora" id="llegada-hora-label">Hora de llegada:</label>
                        <input type="text" id="llegada-hora" class="config-input" value="00:00:00" readonly>
                    </div>
                    <div class="config-line" style="flex-direction: column; align-items: stretch;">
                        <label for="llegada-notas" id="llegada-notas-label">Notas (opcional):</label>
                        <textarea id="llegada-notas" class="config-input" rows="3" placeholder="Observaciones sobre la llegada..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success" id="confirm-llegada-btn">Registrar Llegada</button>
                <button class="btn" id="cancel-llegada-btn">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal de clasificación AHORA YA NO SE UTILIZA en llegadas hce uno nuevo para pantalla externa -->
    <div class="modal" id="ranking-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="ranking-modal-title">Clasificación de la Carrera</h3>
                <button class="modal-close" id="ranking-modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="ranking-table-container">
                    <table class="llegadas-table" id="ranking-table">
                        <thead>
                            <tr>
                                <th>Pos</th>
                                <th>Dorsal</th>
                                <th>Tiempo Final</th>
                                <th>Diferencia</th>
                                <th>Nombre</th>
                                <th>Apellidos</th>
                                <th>Categoría</th>
                                <th>Equipo</th>
                            </tr>
                        </thead>
                        <tbody id="ranking-table-body">
                            <!-- Las filas se agregarán aquí dinámicamente -->
                        </tbody>
                    </table>
                    <div id="ranking-empty" class="empty-state">
                        <i class="fas fa-trophy"></i>
                        <p id="no-ranking-text">No hay suficientes datos para generar la clasificación</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" id="export-ranking-pdf-btn">
                    <i class="fas fa-file-pdf"></i> Exportar Clasificación PDF
                </button>
                <button class="btn" id="close-ranking-btn">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Video oculto para mantener pantalla activa -->
    <video id="keep-alive-video" style="display: none;" muted playsinline>
        <source src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4" type="video/mp4">
    </video>

    <!-- Mensajes flotantes -->
    <div id="message" class="message"></div>

    <!-- =========================================== -->
    <!-- SCRIPT JAVASCRIPT -->
    <!-- =========================================== -->
    <script src="Crono_CRI_js_Main.js"></script>
    <script src="Crono_CRI_js_Traducciones.js"></script>
    <script src="Crono_CRI_js_Utilidades.js"></script>
    <script src="Crono_CRI_js_Cuenta_Atras.js"></script>
    <script src="Crono_CRI_js_UI.js"></script>
    <!-- <script src="Crono_CRI_js_Salidas.js"></script> -->
    <script src="Crono_CRI_js_Salidas_1.js"></script>
    <script src="Crono_CRI_js_Salidas_2.js"></script>
    <script src="Crono_CRI_js_Salidas_3.js"></script>
    <script src="Crono_CRI_js_Salidas_4.js"></script>
    <script src="Crono_CRI_js_Llegadas.js"></script>
    
    <script src="Crono_CRI_js_Storage_Pwa.js"></script>

    <!-- Script para XLSX -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.1.25/jspdf.plugin.autotable.min.js"></script>

    <script>
    // Inicializar cuando todo esté cargado
    document.addEventListener('DOMContentLoaded', function() {
        setTimeout(initApp, 100);
    });
    </script>
</body>
</html>