Crono CRI

#### Traspasar a otras app - cerrar bloques, botones en grid

Quiero crear una app para ayudar a las salidas de las contra relojes de ciclismo.

Partiendo de la app cuenta atrás, la diferencia es que se importará un Excel con todos los datos de la cri, por tanto se ha de mantener diseño y estructura igual y solo añadir la parte de entrada de datos de corredores y tiempos de salida. Además en la pantalla de cuenta atrás se mostrarán los datos del corredor.

iconos: Crono_CRI_192x192.png Crono_CRI_512x512.png

Vamos a detallar.

Sustituiremos el apartado de salida por tramos por el nombre de Orden de Salida.
Ese orden se podrá introducir manualmente o a través de importar un excel.

El fichero será un xlsx con las siguientes columnas
Número de orden
Dorsal
Tiempo de salida ( respecto al tiempo del crono) 
Hora de salida ( según hora del día)
Nombre
Apellido

Habrá un campo para fijar a que hora se empieza la cuenta atras y es a esa hora que el programa automaticamente arrancará la pantalla de cuenta atras.

El crono hará las cuentas atrás en función de este Excel y del campo tiempo de salida.

Se ha de poder introducir manualmente el orden de salida, siendo únicamente obligatorio el dorsal y tiempo de salida, al crear nuevo registro ha de calcular el nuevo tiempo de salida en función de cuánto fue la última vez la diferencia entre el corredor anterior y al previo a ese.

El usuario ha de poder modificar los datos del orden de salida, borrar la importación realizada.

Que haya la opción de crear el Excel vacío para que el usuario lo rellene

En la pantalla de cuenta atrás se mostrará en la parte superior lo mismo, pero en la parte inferior de la pantalla : número de dorsal, apellido,”,”, nombre, hora de salida y tiempo de salida del próximo corredor. 
Debajo de la cuenta atrás, el dorsal, nombre y apellido del corredor actual. El tamaño del texto ha de ser 1/5 del tiempo del crono.

La opción de exportar, exportará el número de dorsal, nombre apellido, hora y tiempo real salida, hora y tiempo previsto de salida.

El inicio del crono que tengas tres opciones desde el primer corredor, desde el número del siguiente dorsal del último dorsal que salió o desde el dorsal que indique el usuario.
************************************
Realizar la parte gráfica de añadir la opción de Gestión del Orden de salida:
Estará después del bloque de Gestión de Carrera

Tendrá 4 bloques:
Bloque 1 - título - Orden de Salida
Bloque 2 - Hora Salida Primer Corredor (valor modificable), Hora del Día (sin titulo, solo mostrar la hora del sistema), diferencia entre estos dos tiempos (Hora de Salda+1min+hora del sistema - sin titulo) y Total Corredores.
Bloque 3 - Botones de Acción: Crear Plantilla Importación, Importar Orden Salida, Eliminar Orden de Salida,Exportar Orden de Salida y Añadir Corredor
Bloque 4 - Una tabla con el Orden de salida - Columnas: Orden, Dorsal, Crono Salida, Hora Salida, Nombre, Apellidos, Chip, Hora Salida Real, Crono Salida Real, Hora Salida Prevista, Crono Salida Prevista, Hora Salida Importado, Crono Salida Importado, Crono Salida Segundos, Hora Salida Segundos
Cada fila se podrá modificar, y las columnas se podran ordenar (de momento no programemos)


estamos trabajando muy bien en equipo para hacer el crono_cri, pero cada vez los procesos de cambios se vuelven muy complicados porque los ficheros estan muy grandes.
Creo que lo bueno seria trabajar con ficheros no muy grandes para que te los pueda enviar y los puedas analizar, pero si creamos muchos entonces yo pierdo el control de que ficheros te tengo que enviar para que tu tengas claro donde se han de hacer las modificaciones.
también seria interesante que en el inicio de estos archivos te pongas indicaciones que te ayuden a saber que si cambias algo sepas en que archivos estan y me los pidas. hay veces que me dices que una función se tiene que crear porque la llama una parte del archivo y no ves esa función en los arhivos que te envio.

Bajo mi punto de vista habria los siguientes siguiendo los criterios de cuando se realice un cambio tener que enviar el manor numero de ficheros, y que esos ficheros tengan un tamaño pequ´ño para facilitarme el envio a ti.

CRI_js_general.js - aquí estarían las funciones que van a ser llamadas por cualquier otra parte del programa con asiduidad, o que van  a ser necesitadas de cambiar (initapp,...)
CRI_js_traducciones - aquí estaria todo lo que tiene que ver con las traducciones - const translations = { es: {, pdateModalTexts() , updateLanguageUI() 
CRI_js_salidas - aquí todas las  funciones que tengan que ver con los procesos de salidas (orden de salida, cuenta atras, etc...)
CRI_js_llegadas - aquí todas las otras funciones que tengan que ver con las llegadas.

y ya tengo las dudas de si crear 
CRI_js_utilidades.js - para tener aquí todas aquellas funciones secundarias, que una vez definidas, es muy poco probable que se tengan que modificar cuando evolucionemos la app, por ejemplo los temas de sonido, etc...

CRI_js_UI.js - para aquellas funciones auxiliares de la interfaz gráfica.


Dime que te parece y que propuesta me haces.
crono_cri/
├── Crono_CRI_js_Main.js            # Punto de entrada principal - Configuración y estado global
├── Crono_CRI_js_Traducciones.js    # Traducciones y funciones de idioma
├── Crono_CRI_js_Salidas1 ,2, 3, 4.js         # Todo el módulo de salidas
├── Crono_CRI_js_Llegadas.js        # Todo el módulo de llegadas
├── Crono_CRI_js_Ui.js              # Interfaces y componentes UI
├── Crono_CRI_js_Utils.js           # Utilidades generales (sonido, Excel, etc.)
└── Crono_CRI_js_Storage_Pwa.js     # Funciones de persistencia (localStorage) Funcionalidades PWA/Service Worker

seguido al grupo de orden de salida, habra la elección de si se va a estar en Modo Salida o Modo Llegadas.
Cuando se elija un modo, debajo aparecerá el contenido que expongo despues.

Dentro del Modo Salida Habrá la Configuración de Audio (mover el antiguo aqui), Ultimo Corredor en Salir y Salidas Registradas  (mover el antiguo aqui)
Al llegar Inicio Cuenta atrás en: a cero se activará la pantalla de cuenta atras que ya existe.

Dentro del modo de Llegadas habrá un Cronometro (Diferencia entre Hora actual del sistema-Hora Salida Primer Corredor:
) con un boton pulsador

estion carrera
copias de seuridad
generar pDF de salida

las columnas de la tabla orden de salida han de tener globos de ayuda:

Orden - posición en la que saldrá el corredor
Crono salida - Tiempo de Cronometro en el que saldrá el corredor. El programa utiliza este valor para dar las salidas.
Hora salida - hora prevista de salida, es información, no se utiliza.
Hora salida real - será la hora del dia en la que efectivamente salió el corredor.
Crono salida real - será la hora del crono en la que efectivamente salió el corredor.
Hora salida prevista - será la hora del dia en la que estava previsto que saliese el corredor. La variación vendra por si se modificó la hora de salida del corredor o la diferencia (si se cambia la hora de salida del primero no se modificará).
Crono salida prevista - será la hora del crono en la que estava previsto que saliese el corredor. La variación vendra por si se modificó la hora de salida del corredor o la diferencia (si se cambia la hora de salida del primero no se modificará).
Hora salida importado - será la hora del dia que estava en el excel que se importó.
Crono salida importado - será la hora del crono que estava en el excel que se importó.


quiero añadir dos campos más en el excel y la tabla de orden de salida y es la conversion a segundos de la hora real de salida y el crono real de salida, esas columnas se llamaran Crono Salida Real Segundos y Hora Salida Real Segundos


te digo como lo quiero, primero el nombre de la prueba, debajo Orden de Salida, y esto centrado en la página, luego jusitificado (sin titulo) a la izquierda lugar, y al lado fecha, debajo tipo prueba y al lado categoria y Total Corredores: y su valor, al lado Salida Primer Corredor: y al lado Salida último Corredor. la cabecera de la tabla la quiero del mismo color que el ejemplo azul creo que es, y los titulos y valores de pos, dorsal, hora salida y crono centrado, y apellidos y nombre jsutificado izquierda, y automatiza el calculo del numero de registros que caben en una hoja


traducir PDF
cuando editas datos de carrera crea una nueva
cuando hay scroll en orden de salida mantener la cabecera

los unicos valores que se pueden modificar en la tabla de orden de salida son: dorsal,diferencia, nombre, apellidos, chip - deshabilitar posicion y habilitar diferencia

el primer  orredor diferencia 00:00:00


al actualizar los datos de la tabla desaparecen

al introducir manualmente un corredor preguntamos si lo pone al principio o en que posición, en función donde vaya se calcula a los siguientes corredores su hora de salida teniendo en cuenta que el corredor añadido tendrá la diferencia igual al anterior corredor. y a la vez se actualiza el valor en segundos de lo que hemos modificado

al introducir manualmente un corredor 
al introducir un corredor si es el primero o posición 1, se le pone crono salida 00:00:00 y en hora de salida la salida prevista del primer corredor y al que ahora sera segundo registro le pones como valor de diferencia el del tercero. y vuelves a calcular el valor de crono salida como crono del anterior más el campo diferncia y hora salida como hora salida anterior mas diferencia. y ademas actualizas tambien con esos valores hora salida prevista y crono prevista

al introducir el ultimo corredor u otra posición ponemos como datos, el valor diferencia seria el valor del registro anterior, y sobre los valores anteriores añadimos la diferencia para crono salida, hora salida, y hora salida prevista y crono salida prevista, en hora salida importado y crono salda importado lo dejamos en blanco y convertimos a segundos crono salida y hora salida. Si hay registros depués del añadido recalculamos los tiempos de las mismas columnas, NO modificamos importado.

en la tabla orde de saldida bloquear cabecera campos

-------------------------------------------------

El programa de cri sera un programa para la ayuda para realizar Carreras de Contrareloj. Tendrá tres partes, gestión general, gestión salidas y gestión de llegadas 
En la gestión general, definiremos los datos comunes, esto es idioma, datos carrera y orden de salida.
En gestión de salidas, mostraremos el reloj de cuenta atrás y el listado de salidos.
En gestión de carreras, tendremos un cronómetro para saber la hora de llegada de cada corredor, importaremos tiempos de salida y por la diferencia entre llegada y salida obtendremos el tiempo de la crono y a partir de aquí tendremos una clasificación, que mostraremos en nuestro dispositivo o en pantalla externa. 
Otras consideraciones: Más adelante intentaremos que un dispositivo externo nos diga el dorsal y tiempo de cada corredor que llega o sale. El programa a base de importación/exportacion de Excel compartirá la información entre salidas y llegadas, que estarán en dispositivos diferentes.

en la importacion hay unos condicionantes si la Hora Salida Importado	Crono Salida Importado estan vacios, entonces lo rellenamos con Hora salida y con Crono salida, y lo mismo si Hora Salida Prevista	Crono Salida Prevista estan vacios
Al acabar la importación actulizas el total de corredores con el valor de los registros importados

al importar excel actualizar hora de salida primer corredor

Importado - valor cuando Importado
Prevista - valor que se puede cambiar una vez importado
Real - valor real

Crono-cri/
├── Crono_CRI.html
├── Crono_CRI_manifest.json
├── Crono_CRI.css
├── Crono_CRI.js
    Crono_CRI_ui.js
    Crono_CRI_utilidades.js
    Crono_CRI_traducciones.js
├── Crono_CRI_ws.js
├── Crono_CRI_192x192.png      # Icono 192x192
├── Crono_CRI_512x512.png      # Icono 512x512
├── Crono_CRI_maskable_192x192.png  # (Opcional)
├── Crono_CRI_maskable_512x512.png  # (Opcional)
├── audio/
│   ├── es_10.ogg
│   ├── es_5.ogg
│   └── ...
└── plantilla-cri.xlsx


Para empezar vamos a dejar el programa tal y como esta, pero vamos a:

en la tabla orden de salida al modificar el campo diferencia avisamos que si es correcto el cambio, se calcuran las nuevas crono salida, hora salida, crono salida previsto, hora salida prevista. y si es que si ejecutamos el cambio



botones de carrera que no van
traducciones
el orden de salida no se raba por carrera

2.0 Salida automatica al llegar a 00

-------------
2.1 Para hacer la cuenta atras la app ha de mirar la tabla de orden de salida y segun el campo crono de salida, y el tiempo de crono/tiempo acumulado hará la cuenta atras.

El proceso ha de ser el siguiente:

Cuando el contador Cuenta atrás en llega a 00:00
2.1.1 Se inicia una cuenta atrás de 60 segundos
2.1.2 El contador de salidos se pone a 0, todos los tiempos de salida real y crono salida real tambien se ponen a valor vacio.
el primer corredor a salir será el primer registro de la tabla.
2.1.3 En la parte superior izquierda se muestra la Hora y el tiempo del crono de la carrera (tiempo acumulado después de la salida del primer corredor)
2.1.4 El tiempo del crono siempre a cero Durante está cuanta atrás.
Cuando la cuenta atrás del primero llega a cero, entonces el crono de la carrera se pone a contar.
la hora de salida real y el crono de salida real se asignaran al corredor que acaba de salir.

2.1.5 El siguiente corredor en salir será el siguiente registro de la tabla, 
2.1.6 El tiempo del siguiente corredor correcto
2.1.7 su cuenta atrás será la diferencia entre el valor de crono salida de la tabla menos el tiempo del crono de la carrera

2.1.8 En la parte inferior y en el centro se mostrará el dorsal, nombre, apellido del corredor al que se le esta haciendo en ese momento la cuenta atras.

2.1.9 Cuenta atras como estaba antes.
2.1.10 Boton Configura cuenta atras
2.1.11 Eliminar el registro de salidas
2.2 Funcionando el Audio
2.2.1 funcionando 4,3,2



quiero rediseñar y mejorar el apartado de inicio cuenta atras manual.
el diseño debe seguir la linea del resto de apartados (configuracion de audio, orden de salida)
el titulo será inicio Manual Cuena Atrás
en su interior tiene que tener:

1.- la hora actual del sistema (no se si se puede aprovechar alguna otra función que esta mostrando la hora del sistema para no tener muchas haciendo lo mismo)
2.- tiempo previo de cuenta atras (utiliza alguna otra función dentro de la app para el manejo de entradas de tiempo) por defecto sera 01:00
3.- posición actual la llamaremos Posición a Salir:
4.- Dorsal a Salir:
5.- botón Iniciar Cuenta atrás
6.- botón Reiniciar



Recuerda indicarme las traducciones a relizar (algunas ya estan por tanto no repitamos)
Si el usuario modifica el dorsal o la posición, el irá a buscar en la tabla de orden de salida, el otro valor, si modifico el dorsal irá a buscar el valor de orden, y a la inversa.
Cuando se de al botón iniciar cuenta atras, se actualizará el crono de carrera, con el tiempo de Crono salida de ese corredor menos el tiempo que hemos indicado en tiempo previo de cuenta atras, y además se actualizará el valor de salidos, con el valor de posición -1.

el boton reiniciar, previa pregunta de confirmación, borrará todos los tiempos de salida y crono real (función implementada ya en el inicio de cuenta atras automatica), también dejará a cero el valor de salidos.

por eso primero pideme las funciones que crees que intervienen en el proceso.
2.3 inicio Cuenta atras manualmente
2.3.1 Traducciones
2.3.2.1 Aplicacion Inicial JS
2.3.3 hora sistema acutalizada
2.3.4 Inicio cuenta atras manual bien
2.3.4.1 mejorado inicio manual dorsal o
2.3.4.2 Bien el manual y cuenta atras
2.3.5 Quitar espacio intercvalos de salida
2.3.5.1 boton de esconder apartados
2.3.6 reinicio funcionando
2.3.6.1 actulizando bien siguente posicion y dorsal a salir
2.3.6.2 actualizar tabla orden de salid con tiempos
2.4 Programa funcionando (siguiente corredor el del orden)
2.4.1 Cuantos faltan por salir y dorsal siguiente en salir - quiero que en la pantalla de cuenta atras donde indica el tiempo en que saldra el proxmo corredor indiques tambien su dorsal ejmplo 20s (300) y donde dice salidos indique 1 de [total de corredores a salir]

2.4.2 al importar orden de salida, la hora crono primero  deberia ser 00:00:00 si no es así pregunta al usuario
diferencia primero siempre es 00:00:00
2.4.3 Registrar bien las salidas. tras la salida de los corredores las horas registradas de crono salida estan mal y la hora salida real registrada esta mal. haz que se pongan los valores que se estan mostrando en la pantalla de cuenta atras cuando llega a o la cuenta atras. total-time-value y current-time-value"
2.4.5 actualizar version  copyriht actualizado
2.1.6.2 Botones pie funcionando 
2.1.6.2 el boton de sugerencias que haga lo mismo que el de la calculadora
2.1.6.2 ayuda funcionando

2.4.9 quitar la marca de + para marcar los modificados, mantener el fondo verde
2.1.6.2 Al añadir un corredor en la ultima posicion añade 2 corredores mas entre el ultimo corredor y el anterior.
2.1.6.2.1 Añadir corredor 1 diferencia ok

2.1.6.2.2 Arreglar multiples carga del titulo de carrera
2.1.6.2 Restaurar Copia de Seguridad Bien
------

3.0 llegadas-timer-display ( es el tiempo del crono en la llegadas) sea igual  = hora del sistema - first-start-time
3.0.1 - arreglado modificacion hora salida primer corredor
3.0.2 -  Parpadeo de current-system-time-display
3.0.3- muestra crono carrera llegadas en marcha
3.0.3 limpiar fucniones anteriores: quitar los botones y funciones de iniciar cronometro, detener, importar salidas. modificar html y js y las funciones que dependiean de ello.
2.1.6.2 -Botones llegadas funcionando

3.1 Llegadas funcionando con captura de tiempo. La mecanica de captura de los tiempos de llegada ha de ser el siguiente, el usuario da al boton Registrar llegada y sin preguntarle automaticamente se registra la llega en la tabla de llegada, cuando ya no hay previsión que llegue otro corredor el usuario introduce tranquilamente el dorsal (piensa que pueden llegar dos y tres corredores a la vez y se ha de coger el tiempo de cada uno). Se deberá asignar al tiempo un dorsal, desde la tabla de orden de llegada que debera estar ordenadade forma inversa esto es que el ultimo en llegar este en la primera linea.

3.1.1 Al introducir el numero de dorsal, vamos a buscar sus datos en la tabla orden de salida. 
Primero en tabla de salida hemos de agregar campos:nombre, apellidos, chip, Crono salida, Hora Salida y Tiempo Final
De allí extraeremos, nombre, apellidos y chip. 

3.1.2 Al buscar en la tabla orden de salida por orden de dorsal, obtendremos datos, y tambien el crono de salida y tiempo de salida, pero atención iremos primero a buscar Hora salida Real, si hay un valor que no sea 00:00:00 o --:--:-- o nulo o vacio , cogeremos este valor de Hora salida real y crono real, sino cogeremos el valor de Hora salida y crono salida, excepto en el primer corredor que si indica cero entonces lo aceptaremos. 
Haremos la diferencia entre tiempo crono y Crono salida de la tabla de llegadas y eso nos dara el Tiempo Final
La clasificacion de la carrera se calculará en base a que dorsal tiene el Tiempo Final mas bajo.

3.1.3 campos nuevos - categoria, equipo, licencia
3.1.4 Modal Clasificacion ok
3_1_5 Boton Clasificacion - PDF
3_1_6 GEnerar PDF funciona a mejorarlo
3_1.6.1 boton PDF en pantalla llegadas
3_1.6.2 Mejora formato PDF
3_1.7 En la tabla de llegadas quiero una columna con la psociín de cada corredor 

3_2 En la tabla de salidas añadir campos nuevos - categoria, equipo, licencia
3_2.2 añadir corredor campos nuevos
3_2.3 Arreglar muestra diferencia primer corredor
3_2.4 Limpieza Consola

3.3 Pantalla externa - en el modulo de llegadas al lado del boton de Clasificacion PDF quiero poner un botón que se llama Pantalla Externa. Este botón estará visible si es posible mostrar la clasificacion en una pantalla externa al ordenador, para eso comprobaremos si tenemos conectada una pantalla externa en modo ampliación de escritorio. Al hacer click mostrara el modal "ranking-modal", que deberá ir actualizandose cada vez que haya una modificación en la tabla de llegadas, para así ir mostrando como van evolucionando los resultados a medida que llegan los corredores

En la cabecera de Llegadas contar los dorsales llegados del total de corredores que hay en la tabla orden de salida.

pantalla externa de resultados

añadir eliminar corredor???
revisar los tiempos de salida